# CloudCompare CMake Configuration File
# This file is generated by CMake and provides package discovery support
# for projects that want to use CloudCompare libraries.
#
# Usage:
#   find_package(CloudCompare REQUIRED)
#   target_link_libraries(your_target CloudCompare::CCCoreLib CloudCompare::QCC_DB_LIB)
#
# Available targets (namespace CloudCompare::):
#   CCCoreLib     - Core point cloud algorithms library
#   QCC_DB_LIB    - CloudCompare database library (qCC_db)
#   QCC_IO_LIB    - CloudCompare I/O library (qCC_io)
#   QCC_GL_LIB    - CloudCompare OpenGL window library (qCC_glWindow)
#   CC_FBO_LIB    - CloudCompare FBO library (CCFbo)
#   CCAppCommon   - CloudCompare application common library
#   CCPluginAPI   - CloudCompare plugin API library
#
# Available variables:
#   CloudCompare_FOUND         - True if CloudCompare was found
#   CloudCompare_VERSION       - Version of CloudCompare
#   CloudCompare_INCLUDE_DIRS  - Include directories for CloudCompare
#   CloudCompare_LIBRARIES     - Libraries to link against
#   CloudCompare_LIBRARY_DIR   - Directory containing CloudCompare libraries
#   CloudCompare_PLUGIN_DIR    - Directory containing CloudCompare plugins

@PACKAGE_INIT@

# Package version
set(CloudCompare_VERSION "@PROJECT_VERSION@")
set(CloudCompare_VERSION_MAJOR "@PROJECT_VERSION_MAJOR@")
set(CloudCompare_VERSION_MINOR "@PROJECT_VERSION_MINOR@")
set(CloudCompare_VERSION_PATCH "@PROJECT_VERSION_PATCH@")

# Check for required CMake version
if(CMAKE_VERSION VERSION_LESS "3.10")
    message(FATAL_ERROR "CloudCompare requires CMake 3.10 or later")
endif()

# Get the directory containing this config file
get_filename_component(CLOUDCOMPARE_CMAKE_DIR "${CMAKE_CURRENT_LIST_FILE}" PATH)

# Set installation directories
set_and_check(CloudCompare_INCLUDE_DIR "@PACKAGE_CLOUDCOMPARE_INCLUDE_INSTALL_DIR@")
set_and_check(CloudCompare_LIBRARY_DIR "@PACKAGE_CLOUDCOMPARE_LIB_INSTALL_DIR@")

# Plugin directory (platform-specific)
if(WIN32)
    set(CloudCompare_PLUGIN_DIR "@PACKAGE_CLOUDCOMPARE_PLUGIN_INSTALL_DIR@")
elseif(APPLE)
    set(CloudCompare_PLUGIN_DIR "@PACKAGE_CLOUDCOMPARE_PLUGIN_INSTALL_DIR@")
else()
    set(CloudCompare_PLUGIN_DIR "@PACKAGE_CLOUDCOMPARE_PLUGIN_INSTALL_DIR@")
endif()

# Store build configuration options
set(CloudCompare_USE_QT_CONCURRENT @CCCORELIB_USE_QT_CONCURRENT@)
set(CloudCompare_USE_TBB @CCCORELIB_USE_TBB@)
set(CloudCompare_USE_CGAL @CCCORELIB_USE_CGAL@)
set(CloudCompare_QT_VERSION @QT_VERSION_MAJOR@)

# Find required dependencies
include(CMakeFindDependencyMacro)

# Qt dependency
if(CloudCompare_QT_VERSION EQUAL 6)
    find_dependency(Qt6 COMPONENTS Core Widgets OpenGL OpenGLWidgets Concurrent REQUIRED)
else()
    find_dependency(Qt5 COMPONENTS Core Widgets OpenGL Concurrent REQUIRED)
endif()

# OpenGL dependency
find_dependency(OpenGL REQUIRED)

# Optional dependencies based on build configuration
if(CloudCompare_USE_TBB)
    find_dependency(TBB REQUIRED)
endif()

if(CloudCompare_USE_CGAL)
    find_dependency(CGAL REQUIRED)
endif()

# Include the targets file
if(NOT TARGET CloudCompare::CCCoreLib)
    include("${CLOUDCOMPARE_CMAKE_DIR}/CloudCompareTargets.cmake")
endif()

# Set convenience variables for include directories
set(CloudCompare_INCLUDE_DIRS
    "${CloudCompare_INCLUDE_DIR}"
    "${CloudCompare_INCLUDE_DIR}/CCCoreLib"
    "${CloudCompare_INCLUDE_DIR}/qCC_db"
    "${CloudCompare_INCLUDE_DIR}/qCC_io"
    "${CloudCompare_INCLUDE_DIR}/qCC_glWindow"
    "${CloudCompare_INCLUDE_DIR}/CCFbo"
    "${CloudCompare_INCLUDE_DIR}/CCAppCommon"
    "${CloudCompare_INCLUDE_DIR}/CCPluginAPI"
)

# Define all possible library targets
set(_CloudCompare_ALL_TARGETS
    CCCoreLib
    QCC_DB_LIB
    QCC_IO_LIB
    QCC_GL_LIB
    CC_FBO_LIB
    CCAppCommon
    CCPluginAPI
)

# Set convenience variable for libraries (only include targets that exist)
set(CloudCompare_LIBRARIES "")
foreach(_target ${_CloudCompare_ALL_TARGETS})
    if(TARGET CloudCompare::${_target})
        list(APPEND CloudCompare_LIBRARIES CloudCompare::${_target})
    endif()
endforeach()

# Check required components
set(_CloudCompare_NOTFOUND_MESSAGE)
foreach(_comp ${CloudCompare_FIND_COMPONENTS})
    if(TARGET CloudCompare::${_comp})
        set(CloudCompare_${_comp}_FOUND TRUE)
    else()
        if(CloudCompare_FIND_REQUIRED_${_comp})
            set(_CloudCompare_NOTFOUND_MESSAGE "${_CloudCompare_NOTFOUND_MESSAGE}\n  CloudCompare::${_comp}")
        endif()
    endif()
endforeach()

if(_CloudCompare_NOTFOUND_MESSAGE)
    set(CloudCompare_FOUND FALSE)
    message(FATAL_ERROR "CloudCompare could not be found because the following required components were not found:${_CloudCompare_NOTFOUND_MESSAGE}")
else()
    set(CloudCompare_FOUND TRUE)
endif()

# Provide some status information
if(NOT CloudCompare_FIND_QUIETLY)
    message(STATUS "Found CloudCompare: ${CLOUDCOMPARE_CMAKE_DIR} (version ${CloudCompare_VERSION})")
    message(STATUS "  Include directory: ${CloudCompare_INCLUDE_DIR}")
    message(STATUS "  Library directory: ${CloudCompare_LIBRARY_DIR}")
    message(STATUS "  Plugin directory: ${CloudCompare_PLUGIN_DIR}")
    if(CloudCompare_USE_QT_CONCURRENT)
        message(STATUS "  Qt Concurrent support: enabled")
    endif()
    if(CloudCompare_USE_TBB)
        message(STATUS "  TBB support: enabled")
    endif()
    if(CloudCompare_USE_CGAL)
        message(STATUS "  CGAL support: enabled")
    endif()
endif()

check_required_components(CloudCompare)
